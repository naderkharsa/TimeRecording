sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/ui/core/Fragment"],function(t,e,o,n){"use strict";return t.extend("sap.ui.timebookings.controller.Main",{onInit:function(){const t={entry:{start:null,end:null,shortText:"",accountingId:"",accountingText:"",projectId:"",project:""},entries:[],timer:0,start:false};const o=new e(t);o.setDefaultBindingMode(sap.ui.model.BindingMode.TwoWay);this.getView().setModel(o);const n=sap.ui.require.toUrl("sap/ui/timebookings/model/projects.json");const i=new e;i.loadData(n,null,false);this.getView().setModel(i,"projectsModel");const r=sap.ui.require.toUrl("sap/ui/timebookings/model/entries.json");const s=new e;s.loadData(r,null,true);s.attachRequestCompleted(()=>{const t=s.getData();if(t&&Array.isArray(t.entries)){o.setProperty("/entries",t.entries)}})},onOpenTimePopup:async function(){const t=this.getView().getModel();let e="";let o="";const i=this.byId("projectSelectMain");if(i){e=i.getSelectedKey();o=i.getSelectedItem()?.getText()||""}t.setProperty("/entry",{start:new Date,end:new Date(Date.now()+30*60*1e3),shortText:"",accountingId:"",accountingText:"",projectId:e,project:o});if(!this._oTimeDialog){this._oTimeDialog=await n.load({id:"timeInfoFragment",name:"sap.ui.timebookings.view.fragment.TimeInfoDialog",controller:this});this._oTimeDialog.setModel(t);this.getView().addDependent(this._oTimeDialog)}t.refresh(true);this._oTimeDialog.open();this.onPopupInputChange()},onPopupAdd:function(){const t=this.getView().getModel();const e=t.getProperty("/entry");const o=t.getProperty("/entries");const n=e.end-e.start;const i=Math.floor(Math.round(n/(1e3*60))/60);const r=Math.round(n/(1e3*60))%60;const s=(i>0?i+"h ":"")+r+"m";const a={start:e.start.toISOString(),end:e.end.toISOString(),shortText:e.shortText,accounting:e.accountingText,accountingId:e.accountingId,project:e.project,projectId:e.projectId,duration:s,date:e.start.toISOString().split("T")[0]};const c=t.getProperty("/editMode");const g=t.getProperty("/editIndex");if(c){o[g]=a;t.setProperty("/editMode",false);t.setProperty("/editIndex",null)}else{o.push(a)}t.setProperty("/entries",o);this._oTimeDialog.close();t.setProperty("/entry",{start:null,end:null,shortText:"",accountingId:"",accountingText:"",projectId:"",project:""})},onStartTimer:function(){const t=this.getView().getModel();const e=t.getProperty("/entry/projectId");if(!e){o.show("WÃ¤hle ein Projekt aus!");return}if(!t.getProperty("/start")){this._startTime=new Date;this._timerInterval=setInterval(()=>{t.setProperty("/timer",t.getProperty("/timer")+1)},1e3);t.setProperty("/start",true)}else{clearInterval(this._timerInterval);this._stopTime=new Date;t.setProperty("/start",false);this._openStopDialog()}},_openStopDialog:function(){if(!this._pStopDialog){n.load({id:this.getView().getId(),name:"sap.ui.timebookings.view.fragment.StopDialog",controller:this}).then(t=>{this._pStopDialog=t;this.getView().addDependent(t);t.open();this._validateStopDialog()})}else{this._pStopDialog.open();this._validateStopDialog()}},onStopConfirm:function(){const t=this.getView().getModel();const e=t.getProperty("/entry");let o=e.projectId;let n=e.project;const i=this.byId("projectSelectMain");if(i){o=i.getSelectedKey();const t=this.getView().getModel("projectsModel");const e=t.getProperty("/projects")||[];const r=e.find(t=>t.projectID===o);n=r?r.project:o}const{start:r,end:s,durationFormatted:a}=this.calculateDuration(this._startTime,this._stopTime);const c={start:r.toISOString(),end:s.toISOString(),shortText:e.shortText,accounting:e.accountingText,accountingId:e.accountingId,project:n,projectId:o,duration:a,date:r.toISOString().split("T")[0]};const g=t.getProperty("/entries")||[];g.unshift(c);t.setProperty("/entries",g);t.setProperty("/entry",{start:null,end:null,shortText:"",accountingId:"",accountingText:"",projectId:"",project:""});t.setProperty("/timer",0);t.setProperty("/start",false);t.refresh(true);this._pStopDialog.close()},onEditEntry:async function(t){const e=this.getView().getModel();const o=t.getSource().getParent().getParent();const i=o.getBindingContext().getPath();const r=parseInt(i.split("/").pop(),10);const s=e.getProperty(i);e.setProperty("/entry",{start:new Date(s.start),end:new Date(s.end),shortText:s.shortText,accountingText:s.accounting,accountingId:s.accountingId,project:s.project,projectId:s.projectId});e.setProperty("/editMode",true);e.setProperty("/editIndex",r);if(!this._oTimeDialog){this._oTimeDialog=await n.load({id:"timeInfoFragment",name:"sap.ui.timebookings.view.fragment.TimeInfoDialog",controller:this});this.getView().addDependent(this._oTimeDialog)}this._oTimeDialog.open()},onDeleteEntry:function(t){const e=this.getView().getModel();const o=t.getSource().getBindingContext();const n=o.getPath();const i=parseInt(n.split("/").pop(),10);const r=[...e.getProperty("/entries")];r.splice(i,1);e.setProperty("/entries",r)},onPopupCancel:function(){this._oTimeDialog.close()},onStopCancel:function(){this._pStopDialog.close()},onPopupInputChange:function(t){const e=this.getView().getModel();const o=e.getProperty("/entry");const n=t?.getSource?.();const i=n?.getId?.()||"";if(i.includes("shortTextInput")){e.setProperty("/entry/shortText",n.getValue())}if(i.includes("projectSelect")){const t=n.getSelectedKey();const o=n.getSelectedItem()?.getText();e.setProperty("/entry/projectId",t);e.setProperty("/entry/project",o)}if(i.includes("accountingSelect")){const t=n.getSelectedKey();const o=n.getSelectedItem()?.getText();e.setProperty("/entry/accountingId",t);e.setProperty("/entry/accountingText",o)}const r=o.start instanceof Date&&!isNaN(o.start);const s=o.end instanceof Date&&!isNaN(o.end);const a=typeof o.shortText==="string"&&o.shortText.trim().length>0;const c=typeof o.projectId==="string"&&o.projectId.trim().length>0;const g=typeof o.accountingId==="string"&&o.accountingId.trim().length>0;const p=r&&s&&a&&c&&g;const d=sap.ui.core.Fragment.byId("timeInfoFragment","addBtn");if(d){d.setEnabled(p)}this._validateStopDialog?.()},_validateStopDialog:function(){const t=this.getView().getModel();const e=t.getProperty("/entry");const o=sap.ui.core.Fragment.byId(this.getView().getId(),"okBtn");const n=e.shortText&&e.shortText.trim().length>0;const i=e.accountingId&&e.accountingId.trim().length>0;if(o){o.setEnabled(!!(n&&i))}},formatHours:function(t){return t!==undefined?String(Math.floor(t/3600)).padStart(2,"0"):"00"},formatMinutes:function(t){return t!==undefined?String(Math.floor(t%3600/60)).padStart(2,"0"):"00"},formatSeconds:function(t){return t!==undefined?String(t%60).padStart(2,"0"):"00"},formatButtonType:function(t){return t?"Negative":"Default"},calculateDuration:function(t,e){const o=e-t;const n=Math.round(o/(1e3*60));const i=Math.floor(n/60);const r=n%60;const s=(i>0?i+"h ":"")+r+"m";return{start:t,end:e,durationFormatted:s}},getGroupHeader:function(t){return new sap.m.GroupHeaderListItem({title:"Datum: "+t.key,upperCase:false})}})});
//# sourceMappingURL=Main.controller.js.map