sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/ui/core/Fragment"],function(t,e,o,n){"use strict";return t.extend("sap.ui.timebookings.controller.Main",{onInit:function(){const t={entry:{date:"",hours:"",shortText:"",projectId:"",project:"",accounting:""},popupStop:{shortText:"",accounting:""},popupData:{start:null,end:null,shortText:"",accounting:"",project:"",projectId:""},entries:[],timer:0,start:false};const o=new e(t);o.setDefaultBindingMode(sap.ui.model.BindingMode.TwoWay);this.getView().setModel(o);const n=sap.ui.require.toUrl("sap/ui/timebookings/model/projects.json");const r=new e;r.loadData(n,null,false);this.getView().setModel(r,"projectsModel");const i=sap.ui.require.toUrl("sap/ui/timebookings/model/entries.json");const s=new e;s.loadData(i,null,true);s.attachRequestCompleted(()=>{const t=s.getData();if(t&&Array.isArray(t.entries)){o.setProperty("/entries",t.entries)}});this._intervalId=null},onOpenTimePopup:async function(){const t=this.getView().getModel();t.setProperty("/popupData",{start:null,end:null,shortText:"",accounting:"",project:"",projectId:""});if(!this._oTimeDialog){try{const e=await n.load({id:"timeInfoFragment",name:"sap.ui.timebookings.view.fragment.TimeInfoDialog",controller:this});this._oTimeDialog=e;e.setModel(t);this.getView().addDependent(e);e.open();this.onPopupInputChange()}catch(t){console.error("Failed to load fragment:",t)}}else{this._oTimeDialog.open();this.onPopupInputChange()}},onPopupAdd:function(){const t=this.getView().getModel();const e=t.getProperty("/popupData");const r=n.byId("timeInfoFragment","startPicker").getDateValue();const i=n.byId("timeInfoFragment","endPicker").getDateValue();if(!r||!i||!e.shortText||!e.projectId||!e.accounting){o.show("Bitte alle Felder ausfÃ¼llen.");return}const{start:s,end:a,durationFormatted:c}=this.calculateDuration(r,i);const p=n.byId("timeInfoFragment","projectSelectPopup");const u=p?.getSelectedItem()?.getText()||e.projectId;const l=t.getProperty("/entries")||[];l.unshift({project:u,projectId:e.projectId,start:s,end:a,accounting:e.accounting,shortText:e.shortText,duration:c});t.setProperty("/entries",l);this._oTimeDialog.close()},onStartTimer:function(){const t=this.getView().getModel();if(!t.getProperty("/start")){this._startTime=new Date;this._timerInterval=setInterval(()=>{const e=t.getProperty("/timer");t.setProperty("/timer",e+1)},1e3);t.setProperty("/start",true)}else{clearInterval(this._timerInterval);this._stopTime=new Date;t.setProperty("/start",false);this._openStopDialog()}},_openStopDialog:function(){if(!this._pStopDialog){n.load({id:this.getView().getId(),name:"sap.ui.timebookings.view.fragment.StopDialog",controller:this}).then(t=>{this._pStopDialog=t;this.getView().addDependent(t);t.open()})}else{this._pStopDialog.open()}},onStopConfirm:function(){const t=this.getView().getModel();const e=t.getProperty("/popupStop");if(!e.shortText||e.shortText.trim().length===0){o.show("beschreibe deine Arbeit.");return}const{start:n,end:r,durationFormatted:i}=this.calculateDuration(this._startTime,this._stopTime);const s=this.byId("projectSelectMain");const a=s?.getSelectedKey();const c=s?.getSelectedItem()?.getText()||a;const p=t.getProperty("/entries")||[];p.unshift({project:c,projectId:a,start:n,end:r,accounting:e.accounting,shortText:e.shortText,duration:i});t.setProperty("/entries",p);this._pStopDialog.close();t.setProperty("/popupStop",{shortText:"",accounting:""});t.setProperty("/timer",0);t.setProperty("/start",false)},onProjectChange:function(t){const e=this.getView().getModel();const o=t.getSource().getSelectedKey();const n=t.getSource().getSelectedItem().getText();e.setProperty("/entry/projectId",o);e.setProperty("/entry/project",n.split(" (")[0])},onAccountingChange:function(t){const e=this.getView().getModel();const o=t.getSource().getSelectedItem().getText();e.setProperty("/entry/accounting",o)},getGroupHeader:function(t){return new sap.m.GroupHeaderListItem({title:"Datum: "+t.key,upperCase:false})},onSearch:function(t){const e=t.getParameter("query");const o=this.byId("entryList");const n=o.getBinding("items");const r=[];if(e){r.push(new sap.ui.model.Filter("project",sap.ui.model.FilterOperator.Contains,e))}n.filter(r)},onDeleteEntry:function(t){const e=this.getView().getModel();const o=t.getSource().getBindingContext();const n=o.getPath();const r=parseInt(n.split("/").pop(),10);const i=[...e.getProperty("/entries")];i.splice(r,1);e.setProperty("/entries",i)},onPopupCancel:function(){this._oTimeDialog.close()},onStopCancel:function(){this._pStopDialog.close()},onDescriptionChange:function(t){const e=t.getSource().getValue();const o=n.byId(this.getView().getId(),"okBtn");if(o){o.setEnabled(e.trim().length>0)}},onPopupInputChange:function(t){const e=this.getView().getModel();const o=e.getProperty("/popupData");const n=t?.getSource()?.getId?.().includes("shortTextInput2")?t.getSource().getValue():o.shortText;const r=o.start instanceof Date&&!isNaN(o.start);const i=o.end instanceof Date&&!isNaN(o.end);const s=typeof n==="string"&&n.trim().length>0;const a=typeof o.projectId==="string"&&o.projectId.trim().length>0;const c=typeof o.accounting==="string"&&o.accounting.trim().length>0;const p=r&&i&&s&&a&&c;const u=sap.ui.core.Fragment.byId("timeInfoFragment","addBtn");if(u){u.setEnabled(p)}},formatHours:function(t){return t!==undefined?String(Math.floor(t/3600)).padStart(2,"0"):"00"},formatMinutes:function(t){return t!==undefined?String(Math.floor(t%3600/60)).padStart(2,"0"):"00"},formatSeconds:function(t){return t!==undefined?String(t%60).padStart(2,"0"):"00"},formatButtonType:function(t){return t?"Negative":"Default"},calculateDuration:function(t,e){const o=e-t;const n=Math.round(o/(1e3*60));const r=Math.floor(n/60);const i=n%60;const s=(r>0?r+"h ":"")+i+"m";return{start:t,end:e,durationFormatted:s}},onSave:function(){},onCancel:function(){}})});
//# sourceMappingURL=Main.controller.js.map